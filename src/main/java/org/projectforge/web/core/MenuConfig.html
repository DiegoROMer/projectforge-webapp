<wicket:panel xmlns:wicket="http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd">
<ul class="nav pf_menueconfig">
  <li class="dropdown">
    <a href="#" id="mm_configure" class="dropdown-toggle" data-toggle="dropdown">
      <i class="icon-pencil"></i>
    </a>
    <ul class="dropdown-menu" id="draggable">
      <li>
        <a href="#"><span>Common</span></a>
        <ul>
          <li>
            <a href="./teamCalendar">Calendar</a>
          </li>
          <li>
            <a href="./teamCalList">List of calendars</a>
          </li>
          <li>
            <a href="./bookList">Books</a>
          </li>
          <li>
            <a href="./addressList">Addresses</a>
          </li>
          <li>
            <a href="./sendSms">Send SMS</a>
          </li>
          <li>
            <a href="./search">Search</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#"><span>Project management</span></a>
        <ul>
          <li>
            <a href="./taskTree">Tasks</a>
          </li>
          <li>
            <a href="./timesheetList">Time sheets</a>
          </li>
          <li>
            <a href="./monthlyEmployeeReport">Monthly employee report</a>
          </li>
          <li>
            <a href="./personalStatistics">My statistics</a>
          </li>
          <li>
            <a href="./hrList">HR planning</a>
          </li>
          <li>
            <a href="./hrPlanningList">HR planning list</a>
          </li>
          <li>
            <a href="./ganttList">Gantt</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#"><span>Finance</span></a>
        <ul>
          <li>
            <a href="./outgoingInvoiceList">Invoices</a>
          </li>
          <li>
            <a href="./incomingInvoiceList">Incoming invoices</a>
          </li>
          <li>
            <a href="./customerList">Customers</a>
          </li>
          <li>
            <a href="./projectList">Projects</a>
          </li>
          <li>
            <a href="./employeeList">Employees</a>
          </li>
          <li>
            <a href="./employeeSalaryList">Salaries</a>
          </li>
          <li>
            <a href="./orderBookList">Order book</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#"><span>Cost</span></a>
        <ul>
          <li>
            <a href="./accountList">Accounts</a>
          </li>
          <li>
            <a href="./cost1List">Cost 1 ids</a>
          </li>
          <li>
            <a href="./cost2List">Cost 2 ids</a>
          </li>
          <li>
            <a href="./cost2TypeList">Cost 2 types</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#"><span>Reporting</span></a>
        <ul>
          <li>
            <a href="./accountingRecordList">Accounting records</a>
          </li>
          <li>
            <a href="./reportObjectives">Report Objectives</a>
          </li>
          <li>
            <a href="./scripting">Scripting</a>
          </li>
          <li>
            <a href="./scriptList">List of scripts</a>
          </li>
          <li>
            <a href="./datevImport">Datev import</a>
          </li>
        </ul>
      </li>
      <li class="mm_clear">
        <a href="#"><span>Organization</span></a>
        <ul>
          <li>
            <a href="./outgoingMailList">Outbox</a>
          </li>
          <li>
            <a href="./incomingMailList">Inbox</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#"><span>Administration</span></a>
        <ul>
          <li>
            <a href="./myAccount">My account</a>
          </li>
          <li>
            <a href="./userPrefList">My preferences</a>
          </li>
          <li>
            <a href="./changePassword">Change password</a>
          </li>
          <li>
            <a href="./userList">Users</a>
          </li>
          <li>
            <a href="./groupList">Groups</a>
          </li>
          <li>
            <a href="./accessList">Access management</a>
          </li>
          <li>
            <a href="./admin">System</a>
          </li>
          <li>
            <a href="./systemUpdate">Update system</a>
          </li>
          <li>
            <a href="./systemStatistics">System statistics</a>
          </li>
          <li>
            <a href="./configuration">Configuration</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#"><span>Miscellaneous</span></a>
        <ul>
          <li>
            <a href="./toDoList">To-do</a>
          </li>
          <li>
            <a href="./wicket/bookmarkable/org.projectforge.plugins.memo.MemoListPage">Memo's</a>
          </li>
          <li>
            <a href="./doc">Documentation</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./customizeMenu">Customize menu</a>
      </li>
      <li>
        <a href="#" id="showBookmarkLink19">Show as bookmark</a>
      </li>
    </ul>
  </li>
  <li class="pf_plus">
    <a>
      <i class="icon-folder-close"></i>
    </a>
  </li>
</ul>
<script>
$(window).load(function(){

  //to simulate drag event
  var is_dragging = false;

  //to indicate if configuration is active
  var is_configuration_active = false;

  //to indicate if new entry is active
  var is_active_newentry = false;

  //save the menu configuration
  var updateBackend = function() {
    console.log('save');
  }

  //add mouseover event on drag
  var addMouseOverOnDrag = function() {
    $.each($('#pf_sortablecontainer .dropdown, #pf_sortablecontainer .dropdown-submenu'), function(){
      $(this).mouseenter(function() {
        if($(window).width() > 979){
          $(this).addClass('open');
        }
      });
      $(this).mouseleave(function() {
        $(this).removeClass('open');
      });
    });
  }

  //add a new dropdownmenu folder
  var addfolder = function() {
    is_active_newentry = false;
    if( $('#pf_newentry input').val().length == 0 ) {
      $('#pf_newentry').addClass('pf_warning');
    } else {
      $('#pf_newentry').attr('class', '');
      $('#pf_newentry').css('display', 'none');
      $('#pf_newentry').after('<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">' + $('#pf_newentry input').val() + '<b class="caret"></b></a><ul class="dropdown-menu"></ul></li>');
      $('#pf_newentry input').val('');
      $('#pf_newentry').attr('class', '');
      makesortable();
      addMouseOverOnDrag();
      updateBackend();
      $('#pf_sortablecontainer').width($('#pf_sortablecontainer ul.nav').width());
    }
  }

  //to start the configuration
  var openConfiguration = function() {
    is_configuration_active = true;
    //highlight target container
    $('#pf_sortablecontainer ul.nav').addClass('pf_sortable');
    $('.pf_plus').show('fast');
    $('#pf_sortablecontainer, .pf_menueconfig').addClass('pf_configuration_active');
    $('#pf_sortablecontainer > ul').stop().animate({
      left: '103'
    }, 200);
    $.each($('#pf_sortablecontainer a, .pf_menueconfig ul a'), function(){
      $(this).bind('click', function(e){
        e.preventDefault();
      })
    });
    makesortable();
  }

  //to stop the configuration
  var closeConfiguration = function() {
    is_configuration_active = false;
    $('#pf_sortablecontainer ul.nav').removeClass('pf_sortable');
    $('#pf_newentry').css('display', 'none');
    $('#pf_newentry input').val('');
    $('#pf_newentry').attr('class', '');
    is_active_newentry = false;
    $('.pf_plus').hide('fast');
    $('#pf_sortablecontainer, .pf_menueconfig').removeClass('pf_configuration_active');
    $('.pf_menueconfig > li').removeClass('open');
    $('#pf_sortablecontainer > ul').stop().animate({
      left: '70'
    }, 200);
    $.each($('#pf_sortablecontainer a, .pf_menueconfig ul a'), function(){
      $(this).unbind('click');
    });
    destroysortable();
  }

  //destroy sortable to all lists
  var destroysortable = function() {
    console.log('destroy');
    $('.sortable').sortable('destroy')
  }

  //set sortable to all lists
  var makesortable = function() {
    $.each($('#pf_sortablecontainer ul'), function(){
      if(!$(this).hasClass('pf_disable')){
        $(this).addClass('sortable');
      }
    });
    $('.sortable').sortable({
      connectWith: '.sortable',
      tolerance: 'pointer',
      items: 'li:not(.pf_disable li, li.pf_disable)',
      cursor: 'pointer',
      delay: 200,
      cursorAt: { top: -20 },
      zIndex: 20000,
      placeholder: "pf_sortable-placeholder",
      receive: function( e, ui )
      {
        sortableIn = 1;
        $(ui.draggable).appendTo( this );
        if(ui.item.hasClass('dropdown') || ui.item.hasClass('dropdown-submenu'))
        {
          if(ui.item.parent().hasClass('dropdown-menu')){
            ui.item.removeClass('dropdown');
            ui.item.addClass('dropdown-submenu');
            ui.item.remove('b');
          } else if(ui.item.parent().hasClass('nav')){
            ui.item.removeClass('dropdown-submenu');
            ui.item.addClass('dropdown');
          }
        }
      },
      over: function(e, ui) { sortableIn = 1; },
      out: function(e, ui) { sortableIn = 0; },
      start: function(event, ui) {
        is_dragging = true;
        //attach draghelper to dom (z-index)
        innerIttemsArr = ui.item.context.innerText.split("\n");
        $('body').after('<div class="pf_draghelper">' + innerIttemsArr[0] + '</div>');
      },
      beforeStop: function(e, ui) {
        if (sortableIn == 0) {
          ui.item.remove();
        }
      },
      stop: function(event, ui) {
        is_dragging = false;
        //change width of target container
        $('#pf_sortablecontainer').width($('#pf_sortablecontainer ul.nav').width());
        //remove draghelper
        $('.pf_draghelper').remove();
        updateBackend();
      }
    }).disableSelection();
  }

  //initially set width of target container
  $('#pf_sortablecontainer').width($('#pf_sortablecontainer ul').width());

  //set draggable
  $.each($('#draggable ul li'), function(){
    $(this).draggable( {
      stack: $(this),
      cursor: 'pointer',
      revert: false,
      helper: 'clone',
      zIndex: 20000,
      opacity: 0.01,
      connectToSortable: '.sortable',
      drag: function( event, ui )
      {
        //change width of target container dynamically
        $('#pf_sortablecontainer').width($('#pf_sortablecontainer ul.nav').width());
        //position draghelper on mousemove
        $('body').mousemove(function(e){
          $('.pf_draghelper').css({'top': e.pageY+20, 'left': e.pageX+20})
        });
      },
      start: function( event, ui ) {
        //attach draghelper to dom (z-index problem)
        $('body').after('<div class="pf_draghelper">' + ui.helper.prevObject.context.innerText + '</div>');
      },
      stop: function( event, ui ) {
        //close all dropdowns
        $.each($('#pf_sortablecontainer .dropdown'), function(){
          $(this).removeClass('open');
        });
        //remove draghelper
        $('.pf_draghelper').remove();
      }
    });
  });

  //open & close configuration on click
  $('#mm_configure').click(function(){
    if(is_configuration_active == false) {
      openConfiguration();
    } else if (is_configuration_active == true){
      closeConfiguration();
    }
  });

  //mousemove actions
  $('body').mousemove(function(e){
    if(is_dragging){
      //change width of target container dynamically on simulated drag event
      $('#pf_sortablecontainer').width($('#pf_sortablecontainer ul.nav').width());
      //position draghelper on mousemove
      $('.pf_draghelper').css({'top': e.pageY+20, 'left': e.pageX+20})
    }
  });

  addMouseOverOnDrag();

  //make dropdowns work while dragging
  $('.pf_menueconfig > li > ul').mouseenter(function() {
    $('.pf_menueconfig > li > ul').addClass('pf_active_over');
  });
  $('.pf_menueconfig > li > ul').mouseleave(function() {
    $('.pf_menueconfig > li > ul').removeClass('pf_active_over');
  });

  //handle new entries
  $('.pf_plus').click(function(){
    $('#pf_newentry input').val('');
    $('#pf_newentry').attr('class', '');
    if(is_active_newentry == false){
      $('#pf_newentry').css('display', 'block');
      $('#pf_newentry input').focus();
      $('#pf_newentry input').keyup(function(event) {
        if ( event.which == 13 ) {
         addfolder();
        }
      });
      $('pf_safenewentry').click(function(){
       addfolder();
      });
      $('#pf_newentry input').keyup(function(event) {
        if ( event.which == 27 ) {
          $('#pf_newentry').css('display', 'none');
          is_active_newentry = false;
        }
      });
      $('#pf_sortablecontainer').width($('#pf_sortablecontainer ul.nav').width());
      is_active_newentry = true;
    }
  });

  //remove newentry dialog on leave focus
  $('#pf_newentry input').blur(function() {
    $('#pf_newentry').css('display', 'none');
    is_active_newentry = false;
  });

  //add new folder to menu on click
  $('#pf_newentry a').click(function(){
    addfolder();
  });

  //handle click outside configuration panel to close it
  $('html').click(function() {
    closeConfiguration();
  });
  $('.pf_menueconfig, #pf_sortablecontainer').click(function(event){
    event.stopPropagation();
  });

});

</script>

</wicket:panel>